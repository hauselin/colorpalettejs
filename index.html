<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Color Palette Generator Built With D3js">
  <meta name="author" content="Hause Lin">

  <title>Color Palette Generator</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

  <!-- Custom styles for this template -->
  <link href="css/landing-page.css" rel="stylesheet">

  <!-- d3 for color palette  -->
  <script src="https://d3js.org/d3.v5.min.js"></script>

  <!-- css style for page -->
  <style>
    body {
      max-width: 800px;
      margin: 0 auto;
    }

    p {
      line-height: 1.3rem;
      margin-left: 30px;
      margin-right: 30px;
    }

    label {
      width: 50px;
      margin-left: 30px;
      margin-right: 20px;
    }

    input {
      width: 50px;
      margin-left: 10px;
      margin-right: 20px;
    }

    button {
      margin-left: 30px;
      margin-right: 20px;
    }

    #preview {
      width: 90%;
      height: 40px;
      margin-top: 10px;
      margin-left: 30px;
    }

    #levels {
      margin-top: 10px;
      margin-left: 30px;
      margin-right: 30px;
    }

    div.level {
      width: 100%;
      height: 50px;
      display: block;
      margin-bottom: 0.2rem;
      margin-right: 30px;
    }

    div.level div {
      display: inline-block;
      margin-left: 0px;
    }

    /* size of color square */
    div.block {
      height: 100%;
      width: 50px;
      margin-right: 10px;
    }
  </style>
</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-light bg-light static-top">
    <div class="container">
      <a class="navbar-brand" href="#"><strong>Color palette generator for perceptually uniform colors</strong></a>
      <a href="https://github.com/hauselin/colorpalettejs">
        <i class="fab fa-github fa-2x fa-fw"></i>
      </a>
    </div>
  </nav>

  <!-- <h1>Color Palette Generator</h1> -->
  <br><br>
  <p>
    Perceptually uniform colormaps are great for many reasons and look pretty. They were introduced in 2015 (see <a href="https://www.youtube.com/watch?v=xAoljeRJ3lU">talk at SciPy2015</a>) and are available in Python's <a href="http://bids.github.io/colormap/">matplotlib</a>, <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">R</a>, <a href="https://github.com/d3/d3-scale-chromatic">D3js</a>, and others. This app is uses D3js and is a shameless adaptation of <a href="https://gist.github.com/adam-garcia/8d8eded299ec5e16752d04281236b151">Adam Garcia's gist</a>. To begin, select the number of categories and the color palette you'd like to use.
  </p>


  <label for="groups">Categories: </label>
  <input type="number" id="groups" value="5" min="2" max="256">
  <label for="palette">Palette: </label>
  <select name="palette" id="palette">
    <option value="v">viridis</option>
    <option value="i">inferno</option>
    <option value="m">magma</option>
    <option value="p">plasma</option>
    <option value="c">cividis</option>
    <!-- <option value="t">turbo</option> -->
  </select>

  <!-- copy hex values button -->
  <button onclick="copy_hex_values(vals_hex)">Copy hex values</button>
  <script>
              function copy_hex_values(x) {
                  var inp = document.createElement('input');
                  document.body.appendChild(inp);
                  inp.value = x;
                  inp.select();
                  document.execCommand('copy', false);
                  inp.remove();
              }
  </script>

  <div id="preview"></div>
  <div id="levels"></div>


  <script>
      d3.select('input').on('change', function() {
          generatePalette();
      });
      d3.select('input').on('keyup', function() {
          generatePalette();
      });
      d3.select('select').on('change', function() {
          generatePalette();
      });
      function generatePalette() {
          var n = parseInt(d3.select("#groups").property("value"));
          if (n > 256) {
              n = 256;
              d3.select("#groups").property("value", 256);
          }
          var p = d3.select("#palette").property("value");
  
          // Interpolation Scale Proxy
          var paletteProxy = function(_l) {
              switch (p) {
                  case "v":
                      return d3.interpolateViridis(_l);
                  case "i":
                      return d3.interpolateInferno(_l);
                  case "m":
                      return d3.interpolateMagma(_l);
                  case "p":
                      return d3.interpolatePlasma(_l);
                  case "t":
                      return d3.interpolateTurbo(_l);
                  case "c":
                      return d3.interpolateCividis(_l);
                  default:
                      break;
              }
          };
  
          // convert rgb(x,x,x) to hex
          // https://stackoverflow.com/questions/13070054/convert-rgb-strings-to-hex-in-javascript
          function parseColor(color) {
              var arr = []; color.replace(/[\d+\.]+/g, function (v) { arr.push(parseFloat(v)); });
              return {
                  hex: "#" + arr.slice(0, 3).map(toHex).join(""),
                  opacity: arr.length == 4 ? arr[3] : 1
              };
          }
          function toHex(int) {
              var hex = int.toString(16);
              return hex.length == 1 ? "0" + hex : hex;
          }
  
          // Update the preview
          var gradient = "linear-gradient(to right, " +
                         paletteProxy(1.0) + ", " +
                         paletteProxy(0.5) + ", " +
                         paletteProxy(0.0) + "" +
                         ")";
          d3.select("#preview").style("background", gradient);
          d3.select("#preview").style("background", gradient);
  
          // Update the value-levels
          var data = [];
          d3.range(0, 1 + 1/(n - 1), 1/(n - 1))
              .slice(0, n)
              .reverse()
              .map(function(l) {
                  var r, g, b, hex;
                  hex = paletteProxy(l);
                  if (hex.slice(0, 3) == 'rgb') {
                      hex = parseColor(hex).hex;
                  }
                  r = parseInt(hex.slice(1, 3), 16);
                  g = parseInt(hex.slice(3, 5), 16);
                  b = parseInt(hex.slice(5, 7), 16);
                  var obj = {
                      "background": hex,
                      "rgb": [r, g, b]
                  };
                  data.push(obj);
              });
          vals_hex = data.map(i => i.background); // create button to copy values clipboard
          vals_rgb = data.map(i => i.rgb);
  
          d3.select("#levels")
              .html("")
              .selectAll("div")
              .data(data).enter()
              .append("div")
              .classed("level", true)
                  .append("div")
                  .classed("block", true)
                  .style("background-color", function(d) {return d.background;})
                  .select(function() {return this.parentNode})
                  .append("div")
                      .html(function(d){
                          var rgb = "rgb(" + d.rgb.join(", ") + ")";
                          var hex = d.background;
                          return rgb + "<br>" + hex}
                      )
                      .style("position", "absolute")
                      .style("padding-top", "0.5rem")
                      .style("font-size", "90%")
                      .style("padding-left", "1rem");

  
      }
    </script>

  <!-- run script -->
  <script type="text/javascript">
    generatePalette();
  </script>


  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>

</html>